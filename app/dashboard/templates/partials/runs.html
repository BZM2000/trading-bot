<section
  id="status-section"
  hx-get="/dashboard/status"
  hx-trigger="every 90s"
  hx-target="#status-section"
  hx-swap="outerHTML"
>
  <h2>Status</h2>
  <div class="row">
    <div class="column">
      <h3>Portfolio Snapshot</h3>
      {% if portfolio %}
      <ul>
        {% for currency, data in portfolio.balances_json.items() %}
        <li>{{ currency }} — available: {{ data.available }}, hold: {{ data.hold }}, total: {{ data.balance }}</li>
        {% endfor %}
      </ul>
      <small>As of {{ portfolio.ts.strftime('%Y-%m-%d %H:%M') }} UTC</small>
      {% else %}
      <p>No portfolio snapshot stored.</p>
      {% endif %}
    </div>
    <div class="column">
      <h3>Latest Price</h3>
      {% if price %}
      <p>Mid: {{ price.mid }} · Bid: {{ price.best_bid }} · Ask: {{ price.best_ask }}</p>
      <small>Captured {{ price.ts.strftime('%Y-%m-%d %H:%M') }} UTC</small>
      {% else %}
      <p>No price snapshot available.</p>
      {% endif %}
    </div>
  </div>

  <h3>Recent Runs</h3>
  {% if run_logs %}
  <table>
    <thead>
      <tr>
        <th>Started</th>
        <th>Finished</th>
        <th>Kind</th>
        <th>Status</th>
        <th>Tokens</th>
        <th>Error</th>
      </tr>
    </thead>
    <tbody>
      {% for run in run_logs %}
      {% set totals = run.usage_json.get('totals') if run.usage_json else None %}
      <tr>
        <td>{{ run.started_at.strftime('%Y-%m-%d %H:%M') }} UTC</td>
        <td>{% if run.finished_at %}{{ run.finished_at.strftime('%Y-%m-%d %H:%M') }} UTC{% else %}—{% endif %}</td>
        <td>{{ run.kind.value }}</td>
        <td class="status-{{ run.status.value }}">{{ run.status.value }}</td>
        <td>{% if totals %}{{ totals.get('total_tokens', '—') }}{% else %}—{% endif %}</td>
        <td>{% if run.error_text %}<code>{{ run.error_text }}</code>{% else %}—{% endif %}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>No runs recorded yet.</p>
  {% endif %}
</section>
